<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <meta name="apple-mobile-web-app-capable" content="yes">

    <title>MapTest Help</title>
    
<link rel="stylesheet" href="lib/theme/default/style.css" type="text/css">
<link rel="stylesheet" type="text/css" href="openlayers.css">
<link rel="stylesheet" type="text/css" href="maptest.css">

</head>

<body onload="initPage()">
	<div class='page-header'>
		<table style='width:100%'>
			<tr>
				<td style='width: 100px;'><div class='page-title'>MapTest</div></td>
				<td>
					<button id='btn-configure' title='Configuration create/edit'>Configure</button>
					<button id='btn-log' class='btn-log' title='Show log'>Log</button>
				</td>
				<td align='right'><a id='map-link' target='_blank' href=''>Permalink</a> <a href='help.html' target='help'><button class='btn-help' title='Show Help'>?</button></a></td>
			</tr>
		</table>


</div>

<div class='menu-container'>	
<div  > 
	<div style='text-align:left; margin:10px;width:100%'>
		<button id='btn-redraw-all' class='btn-redraw' title='Reload all overlays'></button>
		Auto
		<input type='checkbox' id='auto-redraw' title='Automatically reload overlays'>
		<input type='text' id='auto-redraw-interval' value='2' disabled style='width:30px; text-align:right;'> sec
	</div>
	<div id='overlays' class='menu-panel'>
			<div style='margin-bottom: 10px; '>
			<div style='font-style: italic; margin-bottom: 10px;'>
					<span style='display:table-cell; width: 30px; text-align: center'><img id='map-spinner' src='img/spinner-30.gif' style='display: none; height: 20px;'/></span>
			</div>
			
		</div>
	</div>
</div>
</div>

<div class='info-container'>
	<div id='info-panel-map'  class='info-panel'>
		<div id='map_div' >
			<div class='zoom-panel'>
				<input type='button' value='Zoom' id='btn-zoom' /><input type='text' id='map-extent' class='map-extent' title='min Lon, min Lat, max Lon, max Lat'>				
			</div>
			
		<!-- Map Status panel -->	
			<div class='map-status-panel'  style='display:none;'>
				<div class='btn-close' id='btn-status-close'>x</div>
				<div style='margin-bottom: 10px;'>Map Request Status</div>	
				<div class='map-url'> Request URL: </div> 
				<div  style='margin-bottom:10px;'>
					<a target='_blank' id='map-status-url-href' href=''><span id='map-status-url'></span></a>
				</div>
					
				<div> Response: </div>
				<div id='map-status' class='http-response'></div>
			</div>
			
		<!-- Log panel -->	
			<div class='map-log-panel' style='display:none;'>
				<div class='btn-close' id='btn-log-close'>x</div>
				<div style='margin-bottom: 10px;'>Log
				- Enable <input type='checkbox' id='log-enabled'>
					</div>	
				<div class='log-text'></div>
			</div>
			
		<!-- Data panel -->	
			<div class='map-data-panel' style='display:none;'>
				<div class='btn-close' id='btn-data-close'>x</div>	
				<div class='data-text'></div>
			</div>
			
			<!-- Config panel -->	
			<div class='config-panel' style='display:none;'>
				<div class='btn-close' id='btn-config-close'>x</div>
				<div>
					<input type='button' value='Current' id='btn-config-show'/>
					<input type='button' value='Current Visible' id='btn-config-show-visible'/>
					<input type='button' value='Add to Layer List' id='btn-config-add' style='margin-left: 20px;'/>
				</div>
				<textarea id='config-text' placeholder='Enter configuration text'></textarea>
				<div class='config-wms-layers'></div>
				<div>
					<input type='button' value='Clear Layer List' id='btn-overlay-clear' style='color:red;right:40px;position:absolute;'/>
				</div>
			</div>

			<!-- WMS panel -->	
			<div class='wms-panel' style='display:none;'>
				<div class='btn-close' id='btn-wms-close'>x</div>
				<div class='wms-info'>
					<label id='wms-host-url'></label>
				</div>
				<div>
					<label>Filter</label> <input type='text' id='wms-layer-filter'/>
					<input type='button' value='Add All' id='btn-wms-layer-select'/>
					<input type='button' value='Reload' id='btn-wms-layer-reload'/>
				</div>
				<div class='wms-layers'></div>
			</div>
		</div>
	
	</div>
</div>



<script type="text/javascript" src="lib/proj4js-compressed.js"></script>
<script type="text/javascript" src="lib/OpenLayers.js"></script>
<script type="text/javascript" src="lib/jquery-1.9.1.min.js"></script>
<script type="text/javascript" src="ol/ScaleEx.js"></script>
<script type="text/javascript" src="urlParams.js"></script>
<script type="text/javascript" src="maptest.js"></script>
<script type="text/javascript" src="Overlay.js"></script>
<script type="text/javascript" src="WMSProof.js"></script>
<script type="text/javascript">

function initPage() {
	
	maptest = new MapTest('map_div');
	var configUrl = loadUrlConfig();
	var showConfigPanel = ! configUrl;
	initUI(showConfigPanel);
	//TESTING();
}

function loadUrlConfig() {
	var config = UrlParams.extract(window.location.search);
	if (! config.host) return null;
	var configTxt = config.host + '\n';
	var lyrs = UrlParams.asArray(config.lyr);
	configTxt += lyrs.join('\n');
	
	maptest.loadConfig(configTxt);
	
	if (config && config.extent) {
		maptest.zoom( config.extent );
	}
	
	return configTxt;
}

function initUI(showConfig)
{
	window.onresize = function() {
		maptest.map.updateSize();
	}
	MapTest.closeAll();
	if (showConfig) {
		MapTest.show('.config-panel');
	}
	$('.btn-close').click( MapTest.closeAll );
	$('#btn-log').click(function() { MapTest.show('.map-log-panel'); });
	
	$('#btn-configure').click(function() { MapTest.show('.config-panel');	});
	$('#btn-zoom').click(function() { maptest.zoom( $('#map-extent').val() );	});

	$('#btn-config-add').click(function() { 
		maptest.loadConfig($('#config-text').val());
		//$('#map-link').attr('href', maptest.urlParam());
		$('#config-text').val('');
		$('.config-panel').hide();	
	});
	$('#btn-config-show').click(function() { $('#config-text').val(maptest.configuration());	});
	$('#btn-config-show-visible').click(function() { $('#config-text').val(maptest.configuration(true));	});
	$('#btn-overlay-clear').click(function() { maptest.clear();	});
			
	$('#btn-redraw-all').click(function() { maptest.redrawMap();	})
	$('#auto-redraw').click(function() { 
    	var doAuto = $(this).is(':checked');
		maptest.autoRedraw(doAuto);	
	})
	$('#wms-layer-filter').keyup( wmsLayerFilter );
}

function wmsLayerFilter () {
	var filterText = $('#wms-layer-filter').val().toUpperCase();
	var isEmpty = (filterText.length == 0);
	$('.wms-layers').find('.wms-layer').each(function(i, obj) {
		var spec = $(obj).text().toUpperCase();
		var vis = true;
		if (! isEmpty && spec.indexOf( filterText ) < 0) {
			vis = false;
		}
		 $(obj).toggle(vis);
	});

}
MapTest.log = function(msg) {
	if (! $('#log-enabled').is(':checked')) return;
	$('.log-text').append('<br>' + msg);
}

MapTest.closeAll = function() {
	$('.wms-panel').hide();
	$('.config-panel').hide();
	$('.map-log-panel').hide();
	$('.map-data-panel').hide();
	$('.map-status-panel').hide();
	$('.help-panel').hide();
}
MapTest.show = function(selector) {
	MapTest.closeAll();
	$(selector).show();
}
function TESTING()
{

}

</script>
	</body>
</html>
